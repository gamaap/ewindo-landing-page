<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      img#countryFlag {
        width: 24px;
        height: 16px;
        object-fit: cover;
        border: 1px solid #ccc;
        display: inline-block;
      }
      select {
        padding-left: 0.5rem;
        background-position: 0.5rem center;
        background-repeat: no-repeat;
        width: auto;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="flex items-center space-x-2">
      <!-- Dropdown kode negara -->
      <div class="relative flex items-center">
        <img id="countryFlag" src="" alt="Flag" width="100" class="hidden" />
        <select
          id="countryCode"
          class="dynamic-width border border-gray-300 p-1 rounded bg-white cursor-pointer"
        >
          <option value="" selected disabled>-</option>
        </select>
      </div>

      <!-- Input phone number -->
      <input
        class="w-full border border-gray-300 p-2 rounded"
        placeholder="Phone Number"
        type="text"
      />
    </div>
    <script>
      // Fungsi untuk mendapatkan data dari REST Countries API
      async function fetchCountries() {
        const response = await fetch("https://restcountries.com/v3.1/all");
        const countries = await response.json();

        // Filter negara dengan kode telepon
        const countryOptions = countries
          .filter((country) => country.idd?.root) // Hanya negara dengan kode telepon
          .map((country) => ({
            name: country.name.common,
            flag: country.flags.svg,
            code: `${country.idd.root}${
              country.idd.suffixes ? country.idd.suffixes[0] : ""
            }`,
          }))
          .sort((a, b) => a.name.localeCompare(b.name)); // Urutkan negara secara alfabetis

        return countryOptions;
      }

      // Fungsi untuk mengisi dropdown
      async function populateDropdown() {
        const countryCodeSelect = document.getElementById("countryCode");
        const flagImage = document.getElementById("countryFlag");

        const countries = await fetchCountries();

        // Tambahkan opsi ke dropdown
        countries.forEach((country) => {
          const option = document.createElement("option");
          option.value = country.code;
          option.setAttribute("data-flag", country.flag);
          option.textContent = `${country.name} (${country.code})`;
          countryCodeSelect.appendChild(option);
        });

        // Update bendera ketika pilihan berubah
        countryCodeSelect.addEventListener("change", () => {
          const selectedOption = countryCodeSelect.selectedOptions[0];
          flagImage.src = selectedOption.getAttribute("data-flag");
          flagImage.classList.remove("hidden"); // Tampilkan gambar
        });
      }

      // Inisialisasi dropdown
      populateDropdown();
    </script>
  </body>
</html>
